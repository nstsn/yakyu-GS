# PRD.md

## 1. 背景
プロ野球（NPB）で「満塁ホームランが出た回以降、満塁弾を打った側（A）が点を取りにくい気がする」という観察がある。これをデータで検証し、ブログとして公開できる形にまとめる。

## 2. 目的
- 仮説を数値で検証し、読み手が再現可能な形で提示する。
- 「満塁弾だから」なのか「大きな得点（4点以上）が入ったから」なのかを切り分ける。

## 3. 仮説（このプロジェクトで検証するもの）
### H1: 満塁弾の後、Aの得点率が下がる
- A = 満塁ホームランを打った選手が属するチーム（イベント発生チーム）。
- “以降”は「満塁弾が出た回の次の攻撃回以降」とする。

### H2: タイミング（序盤/中盤/終盤）で現象が変わる
- 例：1回表の満塁弾は相手の攻撃回数が多く、同じ4点でも価値が違う可能性。
- ただし本プロジェクトの主要アウトカムは「得点率」。勝ち負けは主目的ではない。

### H3: 同じ4点でも“作られ方”で違う
- 満塁弾（1打で4点）と、連打などで4点以上を積み上げた回では、以降の得点率が異なる可能性。
- 代理比較として「4点以上イニング（満塁弾あり/なし）」を用いる。

## 4. 定義（固定）
- 対象データ: yakyuu.db（SQLite）
- 対象イニング: 1〜9回まで固定（延長は除外）
- 満塁弾イベント: `event` テーブルで `hr=1` かつ `rbi=4` かつ `on_base` が満塁（1,2,3塁走者が存在）
- Aの総得点: `games` テーブルの `home_inn1..9` または `visitor_inn1..9` の合計（NULL除外）
- 以降得点: イベント回+1 〜 9回の合計（NULL除外）
- 残り攻撃イニング数: イベント回+1 〜 9回のうち、値がNULLでない回数
- 以降得点率: `以降得点 / 残り攻撃イニング数`

## 5. 主要アウトプット（CSV/図/ブログ下書き）
### 5.1 CSV
- `grandslam_events.csv`（満塁弾イベント単位）
- `fourplus_inning_events.csv`（4点以上イニングイベント単位、満塁弾あり/なしフラグ付き）
- `summary.csv`（グループ別集計）

### 5.2 図（PNG）
- 満塁弾あり/なしでの「以降得点率」比較（全体、序盤のみ等）
- 必要ならイニング帯（early/mid/late）別の比較

### 5.3 ブログ下書き（Markdown）
- 章立て: 仮説→設計→結果→解釈→限界→結論
- 図表の挿入位置を明記

## 6. 非目標（やらないこと）
- 勝利確率（WPA等）の精密推定（MVPではやらない。将来拡張）
- 投球単位の分析（球速や球種など）
- 生データ（プレー記録）の転載・再配布

## 7. 成功条件
- 2018〜最新（DBの範囲）で集計が完走し、主要CSV・図・下書きが自動生成される。
- ブログで「なぜこう定義したか」「何が分かるか/分からないか」を説明できる。

## 8. リスクと対策
- リスク: `on_base` の表記揺れで満塁判定がズレる
  - 対策: “1/2/3が含まれる”で満塁判定（厳密表記が確認できれば固定）
- リスク: 9回裏なし（ホーム側の `home_inn9` がNULL）
  - 対策: NULLを“攻撃回なし”として分母から除外
- リスク: 同一試合で満塁弾が複数本
  - 対策: イベント行を残し、イベント単位で分析（必要なら試合単位にも集約）
